<div class="d-flex flex-column align-items-center">
  <h2 class="mb-5 display-5">{{ config.title }}</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="w-50">
    <div class="mb-3 d-flex flex-column w-100">
      @for (field of config.fields; track field.name) {
      <label [for]="field.name" class="mt-3">{{ field.label }}</label>
      <input
        [type]="field.type"
        [formControlName]="field.name"
        [id]="field.name"
        [placeholder]="field.placeholder"
        class="form-control p-2"
        [class.is-invalid]="form.get(field.name)?.invalid && form.get(field.name)?.touched"
        [class.border-dark]="!(form.get(field.name)?.invalid && form.get(field.name)?.touched)"
      />
      @if (form.get(field.name)?.invalid && form.get(field.name)?.touched) {
      <div class="invalid-feedback" style="display: block">
        @for (error of Object.keys(form.get(field.name)?.errors || {}); track
        error) {
        <div>{{ field.errorMessages?.[error] }}</div>
        }
      </div>
      } @if (field.name === 'password'){ @if (config.showPasswordConfirmation) {
      <div class="d-flex flex-column">
        <label for="confirmPassword" class="mt-3">Confirmar Senha</label>
        <input
          type="password"
          formControlName="confirmPassword"
          id="confirmPassword"
          placeholder="••••••••"
          class="form-control p-2"
          [class.is-invalid]="(form.get('confirmPassword')?.invalid || form.errors?.['passwordMismatch']) && form.get('confirmPassword')?.touched"
          [class.border-dark]="!((form.get('confirmPassword')?.invalid || form.errors?.['passwordMismatch']) && form.get('confirmPassword')?.touched)"
        />

        @if (form.get('confirmPassword')?.invalid &&
        form.get('confirmPassword')?.touched) {
        <div class="invalid-feedback" style="display: block">
          @if (form.get('confirmPassword')?.errors?.['required']) {
          <div>Confirmação é obrigatória</div>
          }
        </div>
        } @if (form.errors?.['passwordMismatch'] &&
        form.get('confirmPassword')?.touched) {
        <div class="invalid-feedback" style="display: block">
          <div>Senhas não conferem</div>
        </div>
        }
      </div>
      } } }
    </div>

    <button
      type="submit"
      class="btn btn-primary w-100 fs-5"
      [disabled]="loading"
    >
      @if (loading) {
      <span class="spinner-border spinner-border-sm me-2"></span>
      } {{ loading ? 'Aguarde...' : config.submitButtonText }}
    </button>
  </form>

  @if (errorMessage) {
  <div class="alert alert-danger w-50 mt-4">{{ errorMessage }}</div>
  } @if(sucessMessage) {
  <div class="alert alert-success w-50 mt-4">{{ sucessMessage }}</div>
  }
</div>
