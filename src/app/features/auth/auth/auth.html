<h2>{{ config.title }}</h2>

<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="mb-3">
    @for (field of config.fields; track field.name) {
    <label [for]="field.name">{{ field.label }}</label>
    <input
      [type]="field.type"
      [formControlName]="field.name"
      [id]="field.name"
      [placeholder]="field.placeholder"
    />
    @if (form.get(field.name)?.invalid && form.get(field.name)?.touched) {
    <div class="invalid-feedback" style="display: block">
      @for (error of Object.keys(form.get(field.name)?.errors || {}); track
      error) {
      <div>{{ field.errorMessages?.[error] }}</div>
      }
    </div>
    } }
  </div>

  @if (config.showPasswordConfirmation) {
  <div class="mb-3">
    <label for="confirmPassword">Confirmar Senha</label>
    <input
      type="password"
      formControlName="confirmPassword"
      id="confirmPassword"
      placeholder="••••••••"
      [class.is-invalid]="form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched"
    />

    @if (form.get('confirmPassword')?.invalid &&
    form.get('confirmPassword')?.touched) {
    <div class="invalid-feedback" style="display: block">
      @if (form.get('confirmPassword')?.errors?.['required']) {
      <div>Confirmação é obrigatória</div>
      } @if (form.get('confirmPassword')?.errors?.['passwordMismatch']) {
      <div>Senhas não conferem</div>
      }
    </div>
    }
  </div>
  }

  <button type="submit" class="btn btn-primary w-100 mt-4" [disabled]="loading">
    @if (loading) {
    <span class="spinner-border spinner-border-sm me-2"></span>
    } {{ loading ? 'Aguarde...' : config.submitButtonText }}
  </button>
</form>

@if (errorMessage) {
<div class="alert alert-danger">{{ errorMessage }}</div>
}
